#include <iostream>
#include <algorithm>
#include <vector>
using namespace std;

class Rq{
/*
Ring polynomial: Zq[X]/(X^n+1)
n = 2^n'-1; n'=9 => n=256
*/
private:
    int Q;
    vector<int> Coeffs;

public:
     
    Rq(vector<int> coeffs, int q){ // Constructor 
        int n = coeffs.size() - 1; 
        Coeffs = coeffs;
        Q = q;
        normalise();
    }
    
    Rq operator+(const Rq& other) const{ // Over-riding "+" operator 
        vector<int> result(max(Coeffs.size(),other.Coeffs.size()),0);
        for (int i=0;i<Coeffs.size();i++){
            result[i] += Coeffs[i];
        }
        for (int j=0;j<other.Coeffs.size();j++){
            result[j] += other.Coeffs[j];
        }
        
        return Rq(result,Q);
    }
    
    Rq operator*(const Rq& other) const{ // Over-riding "*" operator 
        vector<int> result(Coeffs.size()+other.Coeffs.size()-1,0);
        for (int i=0;i<Coeffs.size();i++){
            for (int j=0;j<other.Coeffs.size();j++){
                result[i+j] = (Coeffs[i]*other.Coeffs[j]) % Q;
            }
        }
        
        int deg = result.size() - Coeffs.size() - 1;
        int mult =0;
        for (int i=0;i<deg;i++){
            mult = result[i];
            result[i+ Coeffs.size()] -= mult;
            result[i] = 0;
        }
        
        vector<int> final_result(Coeffs.size(),0);
        int index = deg+1;
        
        for (int j=0;j<Coeffs.size();j++){
            final_result[j] = result[index];
            index++;
        }
        
        return Rq(final_result,Q);
    }
    
    Rq operator*(int scalar){ //Multiply with scalar
        vector<int> result(Coeffs.size(),0);
        for (int i=0;i<Coeffs.size();i++){
            result[i] = Coeffs[i]*scalar;
        }
        
        return Rq(result,Q);
    }
    
    Rq pow(int scalar) const { //Over-riding Power operator
        vector<int> result(Coeffs.size(),0);
        int temp = 0;
        if (scalar == 0){
            return Rq({1},Q);
        }
        
        else{
            
            for (int i=0;i<Coeffs.size();i++){
                temp = Coeffs[i];
                for (int j=0;j<scalar;j++){
                    temp *= temp;
                }
                result[i] = temp;
            }
            return Rq(result,Q);
        }
    
    }
    
    void normalise(){ // Brings coeffs in range (-q/2,q/2]
        for(int i=0;i<Coeffs.size();i++){
            if (Coeffs[i]>=Q){
                Coeffs[i] = Coeffs[i] % Q;
            }
        }
    }
    
    void Print(){ //Function to print polynomial
        int n = Coeffs.size()-1;
        for (int i=0;i<Coeffs.size();i++){
            if (i==n){
                cout<<"("<<Coeffs[i]<<")"<<endl;
            }
            else{
                cout<<"("<<Coeffs[i]<<")x^"<<n-i<<"+";
            }
        }
    }
    
};

// Testing Data Type
int main()
{
    
    vector<int> coeffs1 = {1,22,35,58,6,7,67,23};
    int q = 5;
    Rq P1 = Rq(coeffs1,q);
    P1.Print();
    
    vector<int> coeffs2 = {1,21,35,8,64,27,67,24};
    Rq P2 = Rq(coeffs2,q);
    P2.Print();
    cout<<endl;
    
    Rq P3 = P1+P2;
    cout<<"Addition P1+P2 = ";
    P3.Print();
    cout<<endl;
    
    Rq P4 = P1*P2;
    cout<<"Multiplication P1*P2 = ";
    P4.Print();
    cout<<endl;
    
    Rq P5 = P1.pow(2);
    cout<<"Power P1**2 = ";
    P5.Print();
    cout<<endl;
    
    Rq P6 = P1*17;
    cout<<"P1*17 = ";
    P6.Print();
    cout<<endl;
    return 0;
}
